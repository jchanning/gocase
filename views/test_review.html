{{define "content"}}
<div class="max-w-5xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Test Paper Review</h1>
                <p class="text-xl text-gray-600 mt-2">{{.Test.Title}}</p>
                <p class="text-sm text-gray-500 mt-1">
                    {{.Test.Subject.Name}}
                    {{if .Test.Topic}} ‚Ä¢ {{.Test.Topic.Name}}{{end}}
                    ‚Ä¢ {{.Test.ExamStandard}} ‚Ä¢ {{.Test.Difficulty}}
                </p>
            </div>
            <div class="text-right">
                <div class="text-4xl font-bold {{if .Passed}}text-green-600{{else}}text-orange-600{{end}}">
                    {{.Attempt.Score}}/{{.Attempt.TotalPoints}}
                </div>
                <div class="text-sm text-gray-600 mt-1">
                    {{printf "%.0f" .Percentage}}% {{if .Passed}}(Passed ‚úÖ){{else}}(Failed ‚ùå){{end}}
                </div>
            </div>
        </div>
        
        <!-- Summary Stats -->
        <div class="mt-6 grid grid-cols-3 gap-4 text-center border-t pt-4">
            <div>
                <p class="text-2xl font-bold text-green-600">{{.CorrectCount}}</p>
                <p class="text-sm text-gray-600">Correct</p>
            </div>
            <div>
                <p class="text-2xl font-bold text-red-600">{{.IncorrectCount}}</p>
                <p class="text-sm text-gray-600">Incorrect</p>
            </div>
            <div>
                <p class="text-2xl font-bold text-gray-600">{{len .Test.Questions}}</p>
                <p class="text-sm text-gray-600">Total Questions</p>
            </div>
        </div>
    </div>

    <!-- Questions -->
    <div class="space-y-6">
        {{range $index, $question := .Test.Questions}}
        {{$answer := index $.Answers $question.ID}}
        <div class="bg-white rounded-lg shadow-md p-6 {{if $answer}}{{if $answer.IsCorrect}}border-l-4 border-green-500{{else}}border-l-4 border-red-500{{end}}{{end}}">
            <!-- Question Header -->
            <div class="flex items-start mb-4">
                <span class="bg-blue-600 text-white rounded-full w-10 h-10 flex items-center justify-center font-bold text-lg mr-4 flex-shrink-0">
                    {{add $index 1}}
                </span>
                <div class="flex-grow">
                    <div class="flex items-start justify-between">
                        <p class="text-lg font-medium text-gray-800 flex-grow">{{$question.QuestionText}}</p>
                        <div class="ml-4">
                            {{if $answer}}
                                {{if $answer.IsCorrect}}
                                <span class="text-3xl">‚úÖ</span>
                                {{else}}
                                <span class="text-3xl">‚ùå</span>
                                {{end}}
                            {{else}}
                            <span class="text-2xl text-gray-400">‚äò</span>
                            {{end}}
                        </div>
                    </div>
                    {{if $question.ImageURL}}
                    <img src="{{$question.ImageURL}}" alt="Question image" class="mt-3 max-w-lg rounded border shadow-sm">
                    {{end}}
                    <div class="mt-2 text-sm text-gray-500">
                        Worth {{$question.Points}} {{if eq $question.Points 1}}point{{else}}points{{end}}
                    </div>
                </div>
            </div>
            
            <!-- Answer Options -->
            <div class="ml-14 space-y-3">
                {{range $optIndex, $option := $question.Options}}
                <div class="p-4 rounded-lg border-2 transition-all
                    {{if $option.IsCorrect}}
                        border-green-500 bg-green-50
                    {{else if and $answer $answer.SelectedOptionID (eqPtr $answer.SelectedOptionID $option.ID)}}
                        border-red-500 bg-red-50
                    {{else}}
                        border-gray-200 bg-gray-50 hover:bg-gray-100
                    {{end}}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center flex-grow">
                            <span class="w-8 h-8 rounded-full border-2 flex items-center justify-center mr-3 font-semibold
                                {{if $option.IsCorrect}}
                                    border-green-600 bg-green-600 text-white
                                {{else if and $answer $answer.SelectedOptionID (eq $answer.SelectedOptionID $option.ID)}}
                                    border-red-600 bg-red-600 text-white
                                {{else}}
                                    border-gray-400 text-gray-600
                                {{end}}">
                                {{if eq $optIndex 0}}A
                                {{else if eq $optIndex 1}}B
                                {{else if eq $optIndex 2}}C
                                {{else}}D{{end}}
                            </span>
                            <span class="{{if $option.IsCorrect}}font-semibold text-green-900{{else if and $answer $answer.SelectedOptionID (eq $answer.SelectedOptionID $option.ID)}}font-medium text-red-900{{else}}text-gray-700{{end}}">
                                {{$option.OptionText}}
                            </span>
                        </div>
                        <div class="ml-4">
                            {{if $option.IsCorrect}}
                            <span class="bg-green-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                ‚úì Correct Answer
                            </span>
                            {{else if and $answer $answer.SelectedOptionID (eqPtr $answer.SelectedOptionID $option.ID)}}
                            <span class="bg-red-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                ‚úó Your Answer
                            </span>
                            {{end}}
                        </div>
                    </div>
                </div>
                {{end}}
            </div>

            {{if and $answer (not $answer.IsCorrect)}}
            <div class="ml-14 mt-4 p-3 bg-yellow-50 border border-yellow-300 rounded">
                <p class="text-sm text-yellow-800">
                    <strong>üí° Tip:</strong> Review why the correct answer is right and understand where you went wrong.
                </p>
            </div>
            {{end}}
        </div>
        {{end}}
    </div>

    <!-- Navigation Buttons -->
    <div class="mt-8 mb-6 flex justify-center gap-4">
        <a href="/test/results?attempt_id={{.Attempt.ID}}" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
            ‚Üê Back to Results
        </a>
        <a href="/test/start?id={{.Test.ID}}" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
            üîÑ Retake Test
        </a>
        <a href="/tests" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
            üìö Browse Tests
        </a>
    </div>
</div>
{{end}}
